<!DOCTYPE html>
<html>
<head>
<title></title>
<style>

body{
  background-color: #777;
}

.mainContainer{
}

.textbox{
  height: 600px;
  font-size: 20px;
  background-color: #fff;
  border:3px solid #aaa;
  border-style: inset;
}

.button1{
  height:25px;
  border-radius: 5px;
  background-color: #8ac
}

.button2{
  height:25px;
  border-radius: 5px;
  background-color: #8ac
}

.button3{
  height:25px;
  border-radius: 5px;
  background-color: #8ac
}

</style>
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src="randomWords.js"></script>
</head>
<body>


<div class="mainContainer">
<button class="button1">run function1</button>
<button class="button2">run function2</button>
<button class="button3">run function3</button>
<div contenteditable="true" class="textbox"></div>
<div class="infoDiv"></div>
</div>




<script>
//needs like the following chrome extension to disable CORS
//https://chrome.google.com/webstore/detail/allow-control-allow-origi/nlfbmbojpeacfghkpbjhddihlkkiljbi



//global variables
var inputA = []; //input field text as an array
var commandLog = []; //records commands
var lastCommand; //tracks last command for repeatability
var wordBank = []; //saves api response array
var lastWord = ''; //last word being processed



//BUTTONS
//buttons are for testing functionality before replacing their invocation with text commands

//on button click
//replaces words starting with a semicolon with calls function randomWord
document.querySelector('.button1').addEventListener("click", function(){
  inputA = document.querySelector('.textbox').innerText.split(' ');
  for (var i = 0; i < inputA.length; i++) {
    if(inputA[i][0] === ';'){
      commandLog.push(inputA[i]);
      inputA[i] = randomWord(inputA[i]);
    }
  }
  document.querySelector('.textbox').innerText = inputA.join(' ');
});

//on button2 click
//TODO: make function to toggle display command options
document.querySelector('.button2').addEventListener("click", function(){


function apiCall(){
  $.getJSON('https://api.datamuse.com/words?rel_rhy=plan')
  .then(function(response){
    console.log(response);
  });
}
apiCall();


// function apiCall2(){
//   $.ajax({
//           crossDomain: true,
//           url:'https://api.datamuse.com/words?rel_rhy=plan',
//           method: 'GET',
//           headers:{
//               'Access-Control-Allow-Origin':'*'
//           },
//           success: function(response) {
//               console.log(response);
//           }
//         });
// };
// apiCall2();



// $.get('https://api.datamuse.com/words?rel_rhy=plan', function(results){console.log(results)});
//  console.log();

// var request = new Request('https://api.datamuse.com/words?rel_rhy=plan');
// console.log(request);
// fetch(request).then(function(response){
// console.log(response);});



});







//listens to key commands
//spacebar key innitiates: if the last word starts with a semicolon then it will be treated as a command
document.addEventListener("keyup", function(event){
  if(event.which === 32){
    updateStats();
    getText();
    var lastWord = inputA[inputA.length-1].trim();
    //TODO: some bug with ';' at the start of a newline?
    commandLog.push(lastWord);
    if(lastWord[0]===';'){
     console.log('command: ', lastWord);
      command(lastWord);
    }
  }
});




function command(string){
  lastCommand = undefined;
  document.addEventListener("keyup", anotherCommand);
  //TODO:build out more commands
  string = string.trim().slice(1);
  // console.log('string, "'+string+'"');
  lastWord = string;
  if(string === 'rand' || string === ''){
    lastCommand = function(string){inputA[inputA.length-1] = randomWord();};
    lastCommand(string);
    updateView();
  }
  // else {
  //   wordbank = apiCall(string);
  // }


};

function anotherCommand(event){
  console.log('second command: ', event.which);
  if(event.which === 32){
    document.removeEventListener("keyup", anotherCommand);
  } else if(event.which === 186){ //';'
    randomBank=randomWordBank;

    lastCommand = function(string){inputA[inputA.length-1] = randomWordBank();};
    lastCommand(lastWord);
  } else if(event.which === 8){ //del
    inputA[inputA.length-1]='';
    document.removeEventListener("keyup", anotherCommand);
  } else if(event.which === 82){ // 'r'
    apiCallRhy(commandLog[commandLog.length-1].slice(1));
    lastCommand = function(string){inputA[inputA.length-1] = randomWordBank();};
    lastCommand(lastWord);
  } else if(event.which === 74){ // 'j'
    apiCallAdj(commandLog[commandLog.length-1].slice(1));
    lastCommand = function(string){inputA[inputA.length-1] = randomWordBank();};
    lastCommand(lastWord);

  } else {
    document.removeEventListener("keyup", anotherCommand);
  }
  updateView();
};




//call api for noun
function apiCallAdj(string){
  $.getJSON('https://api.datamuse.com/words?rel_jjb='+string)
  .then(function(response){
    console.log(response);
    wordBank = response;
  });
}



//call api for rhyme
function apiCallRhy(string){
  $.getJSON('https://api.datamuse.com/words?rel_rhy='+string)
  .then(function(response){
    console.log(response);
    wordBank = response;
  });
}


//return alternative word
function randomWordBank(){
  var randNum = Math.floor(Math.random()*wordBank.length)
  return wordBank[randNum]['word'];
};



//return alternative word
function randomWord(string){
  var randNum = Math.floor(Math.random()*randWordArray.length)
  return randWordArray[randNum];
};

//updates stats at bottom of page
//TODO: maybe more stats?
function updateStats(){
  getText();

  //object of vocab:count
  var textO = {};
  for (var i = 0; i < inputA.length; i++) {
    var word = inputA[i].trim();
    if(textO[word] === undefined){textO[word] = 1;}
    else {textO[word]++;}
  }

  //vocab count, and word count string
  var totalWords = 0;
  var vocab = 0;
  var wordCountS = '<ul>';
  for(var key in textO){
    if(key !== ''){
      vocab++;
      totalWords += textO[key];
      wordCountS += '<li>"' + key + '": ' + textO[key] + '</li>';
    }
  }
  wordCountS += '</ul>';

  //html string
  var html = '';
  html += '<p>Word count: ' + totalWords + '</p>';
  html += 'Vocabulary: ' + vocab;
  html += wordCountS;

  //print stats
  document.querySelector('.infoDiv').innerHTML = html;
};

//gets text from text field as a global array inputA
function getText(){
  inputA = document.querySelector('.textbox').innerText.split(' ');
};


//renders stored text to text field
function updateView(){
  document.querySelector('.textbox').innerText = inputA.join(' ');
  placeCaretAtEnd( document.querySelector('.textbox') );
};


//moves cursor to end of text
//taken from http://stackoverflow.com/questions/4233265/contenteditable-set-caret-at-the-end-of-the-text-cross-browser
function placeCaretAtEnd(el) {
    el.focus();
    if (typeof window.getSelection != "undefined" && typeof document.createRange != "undefined") {
        var range = document.createRange();
        range.selectNodeContents(el);
        range.collapse(false);
        var sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
    } else if (typeof document.body.createTextRange != "undefined") {
        var textRange = document.body.createTextRange();
        textRange.moveToElementText(el);
        textRange.collapse(false);
        textRange.select();
    }
}





</script>


</body>
</html>