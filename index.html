<!DOCTYPE html>
<html>
<head>
<title></title>
<style>

body{
  background-color: #777;
}

.mainContainer{
}

.textbox{
  height: 600px;
  font-size: 20px;
  background-color: #fff;
  border:3px solid #aaa;
  border-style: inset;
}

.button1{
  height:25px;
  border-radius: 5px;
  background-color: #8ac
}

.button2{
  height:25px;
  border-radius: 5px;
  background-color: #8ac
}


</style>
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src="randomWords.js"></script>
</head>
<body>


<div class="mainContainer">
<button class="button1">run function1</button>
<button class="button2">run function2</button>
<div contenteditable="true" class="textbox"></div>
<div class="infoDiv"></div>
</div>




<script>
//global variables
var inputA = [];
var commandLog = [];



//BUTTONS
//buttons are for testing functionality before replacing their invocation with text commands

//on button click
//replaces words starting with a semicolon with calls function randomWord
document.querySelector('.button1').addEventListener("click", function(){
  inputA = document.querySelector('.textbox').innerText.split(' ');
  for (var i = 0; i < inputA.length; i++) {
    if(inputA[i][0] === ';'){
      commandLog.push(inputA[i]);
      inputA[i] = randomWord(inputA[i]);
    }
  }
  document.querySelector('.textbox').innerText = inputA.join(' ');
});

//on button2 click
//TODO: make function to toggle display command options
document.querySelector('.button2').addEventListener("click", function(){

// $.get('https://api.datamuse.com/words?rel_rhy=plan', function(results){console.log(results)});
//  console.log();
var request = new Request('https://api.datamuse.com/words?rel_rhy=plan');
console.log(request);
fetch(request).then(function(response){
console.log(response);});

});





//listens to key commands
//spacebar key innitiates: if the last word starts with a semicolon then it will be treated as a command
document.addEventListener("keyup", function(event){
  if(event.which === 32){
    getText();
    updateStats();
    var lastWord = inputA[inputA.length-1];
    commandLog.push(lastWord);
    if(lastWord[0]===';'){
     // console.log('command: ', lastWord);
      command(lastWord);
      updateView();
    }
  }
});




function command(string){
  document.addEventListener("keyup", anotherCommand);
  //TODO:build out more commands
  inputA[inputA.length-1] = randomWord(); //for now just replace last word with random word

};

function anotherCommand(event){
  console.log('second command: ', event.which);
  if(event.which === 186){
    inputA[inputA.length-1] = randomWord(); //for now just replace last word with random
  } else {
    document.removeEventListener("keyup", anotherCommand);
  }
  updateView();
};




//return alternative word
function randomWord(string){
  var randNum = Math.floor(Math.random()*randWordArray.length)
  return randWordArray[randNum];
};

//updates stats at bottom of page
function updateStats(){
  getText();
  var html = '';
  html += 'Word count: ' + inputA.length;
  //TODO: more stats, each word count, vocabulary size, etc.
  document.querySelector('.infoDiv').innerHTML = html;
  updateView();
};

//gets text from text field as a global array inputA
function getText(){
  //TODO: needs to be recoded to factor other white space ' ' && '\n' && '\t'
  inputA = document.querySelector('.textbox').innerText.split(' ');
};


//renders stored text to text field
function updateView(){
  document.querySelector('.textbox').innerText = inputA.join(' ');
  placeCaretAtEnd( document.querySelector('.textbox') );
};


//moves cursor to end of text
//taken from http://stackoverflow.com/questions/4233265/contenteditable-set-caret-at-the-end-of-the-text-cross-browser
function placeCaretAtEnd(el) {
    el.focus();
    if (typeof window.getSelection != "undefined" && typeof document.createRange != "undefined") {
        var range = document.createRange();
        range.selectNodeContents(el);
        range.collapse(false);
        var sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
    } else if (typeof document.body.createTextRange != "undefined") {
        var textRange = document.body.createTextRange();
        textRange.moveToElementText(el);
        textRange.collapse(false);
        textRange.select();
    }
}





</script>


</body>
</html>